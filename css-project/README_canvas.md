<!--
 * @Author: TerryMin
 * @Date: 2023-01-10 11:35:35
 * @LastEditors: TerryMin
 * @LastEditTime: 2025-04-11 22:00:28
 * @Description: file not
-->

# CSS 图形处理技术

## Canvas

- Canvas 基础知识

  1. 定义：本质上是一个可以在上面进行绘图操作的矩形区域(就像一块空白的画布)，可以使用**JavaScript 代码在这个区域内绘制各种图形、图像、文本，还能创建动画和游戏等**。在 HTML 中，只需使用 <canvas> 标签来定义这个区域。
  2. canvas 只支持两种形式的图形绘制：矩形和路径（由一系列点连成的线段）。所有其他类型的图形都是通过一条或者多条路径组合而成的。

- Canvas 学习资源
  1. [Canvas Api 基本使用](https://juejin.cn/post/7116784455561248775)
  2. [Canvas 图形动画使用](https://juejin.cn/post/7119495608938790942)

## SVG

- SVG(Scalable Vector Graphics:可缩放矢量图形) 基础知识

  1. 定义：SVG 是一种 XML 语言，可以用来绘制矢量图形，缩放时图形质量不会失真。
  2. SVG 文件全局有效的规则是“后来居上”，越后面的元素越可见。
  3. SVG 嵌入 HTML 文件的几种方式：

     - 使用 <img> 标签：

       - 优点：代码简单，兼容性好，可利用浏览器的缓存机制。
       - 缺点：无法使用 CSS 或 JavaScript 直接操作 SVG 内部元素；不能对 SVG 进行内联样式设置。

         ```html
         <img src="example.svg" alt="An SVG image" />
         ```

     - 使用 <object> 标签：<object> 标签可以嵌入各种类型的外部资源，包括 SVG 文件。

       - 优点：支持外部资源的嵌入，并且可以包含备用内容（当 SVG 无法加载时显示）。
       - 缺点：跨域问题可能会影响资源加载；同样难以直接操作 SVG 内部元素。

         ```html
         <object data="example.svg" type="image/svg+xml"></object>
         ```

     - 使用 <iframe> 标签：<iframe> 标签可以创建一个独立的窗口来显示 SVG 文件。

       - 优点：提供了一个独立的浏览上下文，适合展示复杂的 SVG 内容。
       - 缺点：会增加页面的加载时间和资源消耗；存在跨域安全限制，难以直接与 SVG 进行交互。

         ```html
         <iframe src="example.svg"></iframe>
         ```

     - 内联 SVG：直接将 SVG 代码嵌入到 HTML 文件中。

       - 优点：可以直接使用 CSS 和 JavaScript 操作 SVG 内部元素；无需额外的 HTTP 请求，减少加载时间。
       - 缺点：增加了 HTML 文件的大小；如果多个页面使用相同的 SVG，会造成代码重复。

       ```html
       <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
         <circle cx="50" cy="50" r="40" fill="blue" />
       </svg>
       ```

## Canvas 与 SVG 区别

- Canvas 与 SVG 区别

  - Canvas 和 SVG 是当前 HTML5 中主要使用的图形绘制技术，前者提供画布标签和绘制 API，后者是一整套独立的矢量图形语言,使用 XML 格式定义图像。

  1. 图形类型：

     - Canvas 是位图技术，通过像素操作绘制图形
     - SVG 是矢量图技术，使用 XML 描述图形，缩放时图形质量不会失真。

  2. DOM 支持：

     - Canvas 是单一 DOM 元素，绘制后无法单独访问内部图形，事件只能注册到< canvas>标签上，通过事件委托，可以细化到像素点(x,y)的交互
     - SVG 每个图形都是 DOM 节点，可以单独操作和绑定事件，但也只能控制细化在图形元素上。

  3. 渲染方式：

     - Canvas 采用立即模式：绘制指令执行后不保留图形对象
     - SVG 采用保留模式：维护完整的图形对象树

  4. 适用场景：

     - Canvas 适合大数据量场景（如数千个元素），适合像素处理，动态渲染；适合图像密集型的游戏。
     - SVG 适合复杂交互场景（如图形编辑工具），适合静态图片展示，高保真文档查看和打印的应用场景。

  5. 扩展思考：在现代前端开发中，两种技术常结合使用：

     - 使用 Canvas 渲染大数据量的图表主体
     - 用 SVG 叠加交互元素和文本标签
     - 通过 Web Workers + OffscreenCanvas 提升性能

- 大数据量场景 数千个元素适合用 canvas 而不是 svg

  - 注意：大数据量指图形数据(简单几何图形、复杂路径图形)、图像数据、数据可视化数据、动画数据

  - 渲染机制：

    - SVG：SVG 是基于 XML 文档对象模型（DOM）的，每个 SVG 元素都是一个独立的 DOM 节点。当存在数千个 SVG 元素时，浏览器需要管理大量的 DOM 节点，这会显著增加内存开销，同时频繁的重排和重绘操作会严重影响性能。例如，对一个 SVG 元素的样式或属性进行修改时，浏览器可能需要重新计算整个文档的布局，并重新绘制受影响的部分。
    - <canvas>：<canvas> 是基于像素的绘图 API，它将整个绘图区域视为一个位图。所有的绘制操作都是直接在画布上进行像素级别的操作，不需要创建大量的 DOM 节点。因此，在处理大量元素时，<canvas> 的内存占用和渲染性能都要优于 SVG。

  - 渲染速度：

    - SVG：由于 SVG 的渲染依赖于 DOM 操作，随着元素数量的增加，渲染速度会明显变慢。特别是在需要频繁更新元素状态（如动画、交互等）的场景下，性能问题会更加突出。
    - <canvas>：<canvas> 的绘制是通过 JavaScript 代码直接控制的，渲染速度非常快。即使处理数千个元素，也能保持较高的帧率，提供流畅的用户体验。

  - 内存占用：

    - SVG：每个 SVG 元素都需要在内存中存储其属性、样式和事件等信息，随着元素数量的增加，内存占用会急剧上升。对于移动设备或内存有限的环境，可能会导致页面卡顿甚至崩溃。
    - <canvas>：<canvas> 只需要维护一个画布对象和相关的绘图状态，内存占用相对较低。在大数据量场景下，<canvas> 能够更有效地利用系统资源。

  - 灵活性和可扩展性：

    - SVG：虽然 SVG 具有良好的可访问性和可编辑性，但在处理大量元素时，由于 DOM 操作的限制，其灵活性和可扩展性会受到一定的影响。例如，对大量 SVG 元素进行批量操作（如移动、缩放等）时，需要逐个修改元素的属性，代码复杂度较高。
    - <canvas>：<canvas> 提供了丰富的绘图 API，可以通过编程方式灵活地控制每个元素的绘制和更新。在处理大量元素时，可以通过批量绘制和优化算法来提高性能。同时，<canvas> 还支持离屏渲染和双缓冲技术，进一步提升了其灵活性和可扩展性。

  - 事件处理：
    - SVG：每个 SVG 元素都可以绑定独立的事件，当元素数量较多时，事件处理的复杂度会大大增加，同时也会影响性能。
    - <canvas>：<canvas> 本身不支持直接为每个绘制的元素绑定事件，需要通过手动计算鼠标位置和元素的碰撞检测来实现事件处理。虽然这种方式增加了开发的复杂度，但在大数据量场景下，可以通过优化碰撞检测算法来提高性能。

- 复杂交互场景，适合 SVG 而不是 <canvas>

  - 元素独立性与可操作性

    - SVG：SVG 中的每个图形元素（如 <rect>、<circle>、<path> 等）都是独立的 DOM 节点。开发者能像操作 HTML 元素一样，通过 JavaScript 轻松地访问、修改它们的属性。例如，你可以直接选中某个 SVG 元素，然后改变其颜色、大小、位置等，还能为每个元素单独绑定事件，像点击、鼠标悬停等事件。以下是为 SVG 矩形元素绑定点击事件的示例代码：

    ```html
    <svg width="100" height="100">
      <rect id="myRect" x="10" y="10" width="50" height="50" fill="blue" />
    </svg>
    <script>
      const rect = document.getElementById("myRect");
      rect.addEventListener("click", function () {
        this.setAttribute("fill", "red");
      });
    </script>
    ```

    - <canvas>：<canvas> 是基于像素的绘图 API，它将整个绘图区域视为一个位图。在 <canvas> 上绘制的图形没有独立的元素概念，它们只是画布上的像素集合。如果要对某个图形进行交互操作，就需要手动实现复杂的碰撞检测逻辑，来判断用户的操作（如点击、鼠标移动）是否作用在特定图形上。这不仅增加了开发的复杂度，还会影响性能。

  - 动画与过渡效果：

    - SVG：SVG 支持 CSS 动画和过渡效果，开发者可以使用 CSS 的 transition 和 animation 属性来创建平滑的动画效果，无需编写复杂的 JavaScript 代码。同时，SVG 还支持 SMIL（Synchronized Multimedia Integration Language）动画，提供了更多的动画控制选项。
    - <canvas>：在 <canvas> 中实现动画效果需要不断地清除画布并重新绘制图形，这需要编写大量的 JavaScript 代码来控制动画的每一帧。对于复杂的动画效果，如多个图形的协同动画，开发和维护的难度会大大增加。
